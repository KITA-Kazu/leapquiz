
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英語単語クイズ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap');

        body {
            font-family: 'Montserrat', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #f06d06, #ffab40);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            top: -100px;
            left: -100px;
            animation: float 15s infinite ease-in-out;
        }

        body::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            bottom: -50px;
            right: -50px;
            animation: float 12s infinite reverse ease-in-out;
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            50% { transform: translate(20px, 20px); }
            100% { transform: translate(0, 0); }
        }

        .container {
            background-color: #fff;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            width: 90%;
            max-width: 700px;
            box-sizing: border-box;
            position: relative;
            z-index: 10;
        }

        h1 {
            color: #f06d06;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px #ffe0b2;
        }

        .score-timer {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: #f06d06;
        }

        #question-area {
            margin-bottom: 30px;
            text-align: left;
        }

        #question-word {
            font-size: 1.8em;
            font-weight: bold;
            color: #ff8000;
            margin-bottom: 10px;
        }

        #sentence {
            background-color: #fff3e0;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.2em;
            line-height: 1.6;
            min-height: 80px; /* 適切な高さに調整 */
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap; /* 長い文章に対応 */
        }

        #sentence span.blank {
            display: inline-block;
            width: 100px; /* 空欄の幅 */
            height: 1.2em; /* 空欄の高さ */
            border-bottom: 2px dashed #ff8000;
            margin: 0 5px;
            vertical-align: middle;
        }

        #hint-text {
            margin-top: 15px;
            font-style: italic;
            color: #666;
            min-height: 24px;
        }
        
        /* 新しく追加する意味表示用のスタイル */
        #answer-meaning {
            margin-top: 10px;
            font-size: 1.1em; /* 少し小さめに調整 */
            color: #007bff; /* 青系の色 */
            min-height: 30px;
            text-align: center; /* 中央寄せ */
            line-height: 1.4;
        }
        #answer-meaning strong {
            color: #ff8000; /* 単語を強調する色 */
        }
        #answer-meaning .meaning-line {
            display: block; /* 各行をブロック要素にする */
            margin-bottom: 5px; /* 行間に少しスペース */
        }


        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .option-button, #start-button, #next-button, #hint-button, #restart-button {
            background-color: #ffab40;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .option-button:hover, #start-button:hover, #next-button:hover, #hint-button:hover, #restart-button:hover {
            background-color: #f06d06;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .option-button.correct {
            background-color: #66bb6a; /* 緑 */
        }

        .option-button.wrong {
            background-color: #ef5350; /* 赤 */
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        #result-screen {
            display: none;
            text-align: center;
        }

        #final-score {
            font-size: 3em;
            color: #f06d06;
            margin-bottom: 20px;
            text-shadow: 2px 2px #ffe0b2;
        }

        #start-screen {
            text-align: center;
        }

        #start-screen p {
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #555;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 25px;
                margin: 20px;
            }
            h1 {
                font-size: 2em;
            }
            #question-word {
                font-size: 1.5em;
            }
            #sentence {
                font-size: 1em;
                padding: 15px;
            }
            .option-button, #start-button, #next-button, #hint-button, #restart-button {
                padding: 12px 20px;
                font-size: 1em;
            }
            .options {
                grid-template-columns: 1fr; /* スマホでは1列表示 */
            }
            .score-timer {
                font-size: 1em;
            }
            #answer-meaning {
                font-size: 0.9em; /* スマホではさらに小さく */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>英語単語クイズ！</h1>

        <div id="start-screen">
            <p>1分間でどれだけ多くの単語を正しく答えられるか挑戦しよう！<br>正解: +2点, 不正解: -2点, ヒントあり正解: +1点</p>
            <button id="start-button">スタート！</button>
        </div>

        <div id="quiz-screen" style="display: none;">
            <div class="score-timer">
                <div>スコア: <span id="score">0</span></div>
                <div>残り時間: <span id="timer">60</span>秒</div>
            </div>

            <div id="question-area">
                <div id="question-word"></div>
                <div id="sentence"></div>
                <div id="hint-text"></div>
                <!-- ★ここに単語の意味を表示する要素を追加します★ -->
                <div id="answer-meaning"></div> 
            </div>

            <div class="options" id="options-container">
                <!-- 選択肢がここに動的に追加されます -->
            </div>

            <div class="button-group">
                <button id="hint-button">ヒント (和訳)</button>
                <button id="next-button" disabled>次の問題</button>
            </div>
        </div>

        <div id="result-screen">
            <h2>タイムアップ！</h2>
            <p>あなたの最終スコアは...</p>
            <div id="final-score">0点</div>
            <button id="restart-button">もう一度プレイ</button>
        </div>
    </div>

<script>
const words = [
    { en: "fetch", jp: "取ってくる、入手する", sentence: "They _______ children from the kindergarten.", sentence_jp: "彼らは幼稚園から子供たちを_______。" },
    { en: "purchase", jp: "購入する", sentence: "You can _______ an apartment in Kinshicho.", sentence_jp: "錦糸町にアパートを_______することができる。" },
    { en: "exhibit", jp: "展示する、見せる", sentence: "I will _______ my pictures at the salon.", sentence_jp: "私はサロンに絵を_______。" },
    { en: "sculpture", jp: "彫刻", sentence: "The Thinker is a _______ by Rodin.", sentence_jp: "ロダンの「考える人」は_______である。" },
    { en: "derive", jp: "引き出す、得る", sentence: "Many English words _______ from Latin.", sentence_jp: "多くの英単語はラテン語から_______。" },
    { en: "commit", jp: "犯す、委ねる", sentence: "_______ a sin.", sentence_jp: "罪を_______。" },
    { en: "ancient", jp: "古代の", sentence: "_______ Greek myths.", sentence_jp: "_______ギリシャ神話。" },
    { en: "craft", jp: "工芸品", sentence: "They exhibited their _______ in the regional cultural center.", sentence_jp: "彼らは地域文化センターで彼らの_______を展示した。" },
    { en: "journal", jp: "雑誌、日誌", sentence: "I subscribe to a monthly _______.", sentence_jp: "私は月刊の_______を購読している。" },
    { en: "encyclopedia", jp: "百科事典", sentence: "A thirty-volume _______.", sentence_jp: "30巻の_______。" },
    { en: "divine", jp: "神聖な、神の", sentence: "the _______ right of kings.", sentence_jp: "王権_______説。" },
    { en: "heaven", jp: "天国", sentence: "An astronomer observes the _______.", sentence_jp: "天文学者は_______を観察する。" },
    { en: "funeral", jp: "葬式", sentence: "attend a _______.", sentence_jp: "_______に参列する。" },
    { en: "priest", jp: "司祭", sentence: "The _______ heard his confession.", sentence_jp: "_______は彼の告白を聞いた。" },
    { en: "sacred", jp: "神聖な", sentence: "Cows are _______ animals to the Hindus.", sentence_jp: "牛はヒンドゥー教徒にとって_______な動物だ。" },
    { en: "context", jp: "文脈", sentence: "The meaning of a word depends on the _______.", sentence_jp: "単語の意味は_______に依存する。" },
    { en: "singular", jp: "単数の", sentence: "A _______ form.", sentence_jp: "_______形。" },
    { en: "command", jp: "命令、指揮", sentence: "I have a good _______ of Chinese.", sentence_jp: "中国語が堪能である（_______力がある）。" },
    { en: "instance", jp: "例", sentence: "An _______ of a good baseball player.", sentence_jp: "良い野球選手の_______。" },
    { en: "dialogue", jp: "対話", sentence: "A play has a lively _______.", sentence_jp: "劇には生き生きとした_______がある。" },
    { en: "vowel", jp: "母音", sentence: "Banana has three _______s.", sentence_jp: "Bananaには_______が3つある。" },
    { en: "accent", jp: "アクセント", sentence: "He spoke with a strong German _______.", sentence_jp: "彼は強いドイツ語の_______で話した。" },
    { en: "outline", jp: "概要、あらすじ", sentence: "_______ the plan to him.", sentence_jp: "彼にその計画の_______を説明する。" },
    { en: "remote", jp: "遠い、へんぴな", sentence: "live in a _______ village.", sentence_jp: "_______村に住んでいる。" },
    { en: "endeavor", jp: "努力する、試みる", sentence: "He _______ to finish the project on time.", sentence_jp: "彼は時間通りにプロジェクトを終えるために_______。" },
    { en: "ambition", jp: "野心、目標", sentence: "It has been my _______ to be a pilot.", sentence_jp: "パイロットになるという_______を持っている。" },
    { en: "temper", jp: "気分、機嫌", sentence: "lose one's _______.", sentence_jp: "_______を損ねる。" },
    { en: "enthusiasm", jp: "熱意、熱中", sentence: "My _______ for the plan gradually died.", sentence_jp: "その計画に対する私の_______は徐々に消えていった。" },
    { en: "incredible", jp: "信じられない、素晴らしい", sentence: "What an _______ story!", sentence_jp: "なんて_______話だ！" },
    { en: "dared", jp: "あえて〜する、勇敢にも〜する (dareの過去形)", sentence: "No one _______ to argue with him.", sentence_jp: "誰も彼に異論を唱える_______なかった。" },
    { en: "scream", jp: "叫び声、金切り声", sentence: "give a _______ for help.", sentence_jp: "助けを求めて_______を上げる。" },
    { en: "tempt", jp: "誘惑する", sentence: "The sun's warmth _______ me to go out.", sentence_jp: "太陽の暖かさが私を外出に_______た。" },
    { en: "oppress", jp: "抑圧する、苦しめる", sentence: "The dictator _______ his people for many years.", sentence_jp: "その独裁者は長年、国民を_______てきた。" },
    { en: "threaten", jp: "脅かす", sentence: "_______ to report it to the police.", sentence_jp: "それを警察に_______と_______。" },
    { en: "mercy", jp: "慈悲、情け", sentence: "show _______ to the victim.", sentence_jp: "被害者に_______を示す。" },
    { en: "sacrifice", jp: "犠牲にする", sentence: "_______ my family for my career.", sentence_jp: "キャリアのために家族を_______にする。" },
    { en: "curse", jp: "呪い", sentence: "put a _______ on her.", sentence_jp: "彼女に_______をかける。" },
    { en: "cure", jp: "治療する", sentence: "He was _______ of his illness.", sentence_jp: "彼は病気を_______した。" },
    { en: "stem", jp: "茎、幹、由来する", sentence: "The problem _______ from an unhealthy lifestyle.", sentence_jp: "その問題は不健康な生活習慣が_______である。" },
    { en: "trigger", jp: "引き起こす、誘発する", sentence: "_______ a reaction.", sentence_jp: "反応を_______。" },
    { en: "pull", jp: "引く", sentence: "_______ the trigger.", sentence_jp: "引き金を_______。" },
    { en: "consequence", jp: "結果", sentence: "The _______ of the accident was serious.", sentence_jp: "事故の_______は深刻だった。" },
    { en: "process", jp: "過程、処理", sentence: "The production _______ is fully automated.", sentence_jp: "生産_______は完全に自動化されている。" },
    { en: "resort", jp: "行楽地、頼る", sentence: "a hot spring _______.", sentence_jp: "温泉_______。" },
    { en: "formula", jp: "公式", sentence: "a _______ for success.", sentence_jp: "成功の_______。" },
    { en: "procedure", jp: "手順", sentence: "the _______ for applying for a passport.", sentence_jp: "パスポート申請の_______。" },
    { en: "extraordinary", jp: "並外れた、異常な", sentence: "An _______ diet session.", sentence_jp: "_______ダイエット。" },
    { en: "overwhelming", jp: "圧倒的な", sentence: "The team won an _______ victory.", sentence_jp: "そのチームは_______勝利を収めた。" },
    { en: "entire", jp: "全体の、全部の", sentence: "The _______ audience stood up to cheer.", sentence_jp: "_______観客が立ち上がって歓声を上げた。" },
    { en: "below", jp: "〜の下に", sentence: "The temperature dropped _______ zero.", sentence_jp: "気温は_______を下回った。" },
    { en: "sheer", jp: "全くの、純粋な", sentence: "by _______ coincidence.", sentence_jp: "_______な偶然によって。" },
    { en: "partial", jp: "部分的な、不公平な", sentence: "He is _______ in his judgment.", sentence_jp: "彼の判断は_______だ。" },
    { en: "barely", jp: "かろうじて、ほとんど〜ない", sentence: "He can _______ reach the top shelf.", sentence_jp: "彼は棚の一番上に_______手が届く。" },
    { en: "frequently", jp: "頻繁に", sentence: "He travels _______ for business.", sentence_jp: "彼は仕事で_______出張する。" },
    { en: "formerly", jp: "以前は", sentence: "The building was _______ a school.", sentence_jp: "その建物は_______学校だった。" },
    { en: "merely", jp: "単に、ただ", sentence: "It was _______ a misunderstanding.", sentence_jp: "それは_______誤解だった。" },
    { en: "nevertheless", jp: "それにもかかわらず", sentence: "It was raining; _______, we continued to play outside.", sentence_jp: "雨が降っていた。_______、私たちは外で遊び続けた。" },
    { en: "somehow", jp: "どうにかして、なぜか", sentence: "She _______ managed to finish the project.", sentence_jp: "彼女は_______プロジェクトを終えることができた。" },
    { en: "thus", jp: "したがって、このように", sentence: "He worked hard, _______ he passed the exam.", sentence_jp: "彼は懸命に働き、_______試験に合格した。" },
    { en: "on behalf of", jp: "〜を代表して、〜のために", sentence: "I'm writing _______ my company.", sentence_jp: "会社を_______、この手紙を書いています。" },
    { en: "subsequent", jp: "その後の", sentence: "_______ events.", sentence_jp: "_______の出来事。" },
    { en: "hence", jp: "それゆえに", sentence: "The road was icy; _______, we drove slowly.", sentence_jp: "道路が凍っていた。_______、私たちはゆっくり運転した。" },
    { en: "consequently", jp: "その結果", sentence: "He didn't study; _______, he failed the exam.", sentence_jp: "彼は勉強しなかった。_______、試験に落ちた。" },
    { en: "furthermore", jp: "さらに", sentence: "The house is spacious; _______, it has a beautiful garden.", sentence_jp: "その家は広々としている。_______、美しい庭がある。" },
    { en: "moreover", jp: "その上", sentence: "The book is informative; _______, it is well-written.", sentence_jp: "その本は情報豊富だ。_______、よく書かれている。" },
    { en: "likewise", jp: "同様に", sentence: "He solved the problem easily; _______, his friend did.", sentence_jp: "彼は問題を簡単に解決した。彼の友人も_______した。" },
    { en: "nonetheless", jp: "それにもかかわらず", sentence: "The car was expensive; _______, he bought it.", sentence_jp: "その車は高価だった。_______、彼はそれを買った。" },
    { en: "whereas", jp: "〜であるのに対して", sentence: "Some people prefer coffee, _______ others prefer tea.", sentence_jp: "コーヒーを好む人もいる_______、紅茶を好む人もいる。" },
    { en: "accordingly", jp: "それに応じて", sentence: "The weather forecast was bad; _______, we canceled the picnic.", sentence_jp: "天気予報は悪かった。_______、私たちはピクニックを中止した。" }
    ];


        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const scoreSpan = document.getElementById('score');
        const timerSpan = document.getElementById('timer');
        const questionWordDiv = document.getElementById('question-word');
        const sentenceDiv = document.getElementById('sentence');
        const hintTextDiv = document.getElementById('hint-text');
        const optionsContainer = document.getElementById('options-container');
        const hintButton = document.getElementById('hint-button');
        const nextButton = document.getElementById('next-button');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const finalScoreDiv = document.getElementById('final-score');
        // ★新しく追加した要素を取得します★
        const answerMeaningDiv = document.getElementById('answer-meaning'); 

        let currentScore = 0;
        let timeLeft = 60;
        let timerInterval;
        let currentQuestion = null;
        let usedWords = [];
        let hintUsed = false;
        let questionActive = false; // 問題がアクティブかどうか

        function getRandomWords(count, excludeWord = null) {
            // words配列から重複しないようにランダムに単語を選択
            const availableForOptions = words.filter(word => word.en !== excludeWord);
            const shuffled = [...availableForOptions].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function displayQuestion() {
            // すべての問題を使い切った場合、usedWordsをリセットする
            if (usedWords.length === words.length) {
                usedWords = [];
            }

            let availableWords = words.filter(word => !usedWords.includes(word.en)); // `word.en` で比較
            if (availableWords.length === 0) {
                 availableWords = words; // すべて使い切ったらリセット
                 usedWords = [];
            }

            const randomIndex = Math.floor(Math.random() * availableWords.length);
            currentQuestion = availableWords[randomIndex];
            usedWords.push(currentQuestion.en); // 単語のenプロパティを格納

            // questionWordDiv.textContent = currentQuestion.en; // この行をコメントアウトまたは削除
            sentenceDiv.innerHTML = currentQuestion.sentence.replace(currentQuestion.en, '<span class="blank"></span>');
            hintTextDiv.textContent = ''; // ヒントをリセット
            // ★意味表示エリアもリセットします★
            answerMeaningDiv.textContent = ''; 

            hintUsed = false; // ヒント使用状況をリセット
            hintButton.disabled = false; // ヒントボタンを有効にする
            nextButton.disabled = true; // 次へボタンを無効にする

            const correctWord = currentQuestion.en;
            const options = getRandomWords(3, correctWord); // 正解以外の3つを取得
            options.push(currentQuestion); // 正解を追加
            options.sort(() => Math.random() - 0.5); // シャッフル

            optionsContainer.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('option-button');
                button.textContent = option.en;
                button.dataset.word = option.en;
                button.onclick = () => checkAnswer(button, option.en === correctWord);
                optionsContainer.appendChild(button);
            });
            questionActive = true; // 問題がアクティブになる
            enableOptionButtons(); // 選択肢ボタンを有効にする
        }

        function disableOptionButtons() {
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach(button => {
                button.disabled = true;
                // ホバーエフェクトを無効にするクラスは、CSSで`:disabled`セレクタを使えば不要
                // button.classList.remove('option-button-hover');
            });
        }

        function enableOptionButtons() {
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach(button => {
                button.disabled = false;
                // 必要であれば、ホバーエフェクトを再度有効にするためのクラスなどを追加
            });
        }

        function checkAnswer(selectedButton, isCorrect) {
            if (!questionActive) return; // 問題が非アクティブなら何もしない

            disableOptionButtons(); // すべての選択肢ボタンを無効にする
            questionActive = false; // 問題を非アクティブにする
            hintButton.disabled = true; // ヒントボタンも無効にする

            if (isCorrect) {
                selectedButton.classList.add('correct');
                currentScore += hintUsed ? 1 : 2; // ヒント使用有無で加点変更
            } else {
                selectedButton.classList.add('wrong');
                currentScore -= 2;
                // 正しい答えを緑色で表示
                const correctButton = Array.from(optionsContainer.children).find(btn => btn.dataset.word === currentQuestion.en);
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
            }
            // ★ここに単語の意味と文全体の意味を表示するロジックを修正します★
            const filledSentenceJp = currentQuestion.sentence_jp.replace('_______', `<strong>${currentQuestion.en}</strong>`);
            answerMeaningDiv.innerHTML = `<span class="meaning-line">意味: ${currentQuestion.jp}</span><span class="meaning-line">用例: ${filledSentenceJp}</span>`;
            
            scoreSpan.textContent = currentScore;
            nextButton.disabled = false; // 次へボタンを有効にする
        }

        function startTimer() {
            timeLeft = 60;
            timerSpan.textContent = timeLeft;
            clearInterval(timerInterval); // 既存のタイマーをクリア
            timerInterval = setInterval(() => {
                timeLeft--;
                timerSpan.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            quizScreen.style.display = 'none';
            resultScreen.style.display = 'block';
            finalScoreDiv.textContent = currentScore + '点';
            clearInterval(timerInterval); // 念のためタイマーを停止
        }

        function resetGame() {
            currentScore = 0;
            scoreSpan.textContent = currentScore;
            timeLeft = 60;
            timerSpan.textContent = timeLeft;
            usedWords = [];
            hintUsed = false;
            questionActive = false;
            clearInterval(timerInterval); // タイマーを確実に停止
            hintTextDiv.textContent = ''; // ヒント表示もクリア
            // ★意味表示エリアもクリアします★
            answerMeaningDiv.innerHTML = ''; // innerHTMLを空にする
            optionsContainer.innerHTML = ''; // 選択肢もクリア
        }

        // イベントリスナーの修正
        startButton.addEventListener('click', () => {
            resetGame(); // まずゲームの状態をリセット
            startScreen.style.display = 'none'; // スタート画面を非表示
            quizScreen.style.display = 'block'; // クイズ画面を表示
            startTimer(); // タイマーを開始
            displayQuestion(); // 最初の問題を表示
        });

        nextButton.addEventListener('click', () => {
            if (timeLeft > 0) {
                displayQuestion();
            } else {
                endGame();
            }
        });

        hintButton.addEventListener('click', () => {
            if (currentQuestion && !hintUsed && questionActive) {
                // ヒント表示は和訳文の穴埋めではなく、単語の和訳と穴埋め用例の組み合わせに
                const hintSentenceJp = currentQuestion.sentence_jp.replace('_______', '_______'); // 穴埋め部分を残す
                hintTextDiv.innerHTML = `ヒント: ${currentQuestion.jp} (用例: ${hintSentenceJp})`;
                hintUsed = true;
                hintButton.disabled = true; // ヒントは一度使うと無効
            }
        });

        restartButton.addEventListener('click', () => {
            resetGame(); // ゲームの状態をリセット
            resultScreen.style.display = 'none'; // 結果画面を非表示
            quizScreen.style.display = 'block'; // クイズ画面を表示
            startTimer(); // タイマーを開始
            displayQuestion(); // 最初の問題を表示
        });

        // 初期表示
        // ページロード時はスタート画面のみ表示
        startScreen.style.display = 'block';
        quizScreen.style.display = 'none';
        resultScreen.style.display = 'none';
        resetGame(); // 初回ロード時にゲーム状態を初期化
    </script>
 </body>

</html>

<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>英語チェック＋ランキング</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 24px auto; padding: 0 12px; }
    h1 { margin: 0 0 8px; }
    .box { border: 1px solid #ddd; border-radius: 8px; padding: 12px; margin: 12px 0; }
    button { padding: 8px 14px; border-radius: 8px; border: 1px solid #ccc; background: #f7f7f7; cursor: pointer; }
    input { padding: 8px; width: 100%; max-width: 280px; }
    ol { padding-left: 20px; }
  </style>
</head>
<body>
  <h1>英語チェック & ランキング</h1>

  <!-- 1) 名前を入れる -->
  <div class="box">
    <label>名前（ニックネームOK）</label><br/>
    <input id="playerName" placeholder="例）いぶき太郎" />
    <div style="margin-top:8px">
      <button id="startBtn">スタート</button>
    </div>
    <small id="hello" style="display:block;margin-top:6px;color:#666"></small>
  </div>

  <!-- 2) クイズ本体（ここはあなたの既存コードに置き換えOK） -->
  <div class="box" id="quizArea" style="display:none">
    <p>ここにクイズを出す。（サンプルとして3問×各10点＝満点30にしてます）</p>
    <button id="finishBtn">クイズ終了（サンプルで30点満点の乱数にします）</button>
    <div id="result" style="margin-top:8px"></div>
    <div style="margin-top:8px">
      <button id="submitBtn" disabled>スコア送信</button>
    </div>
  </div>

  <!-- 3) ランキング -->
  <div class="box">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 style="margin:0">上位5人</h2>
      <button id="reloadBtn">更新</button>
    </div>
    <ol id="leaderboard"><li>まだ誰もいません</li></ol>
  </div>

  <!-- Firebase公式の読み込み（CDN） -->
  <script type="module">
    // ★★★ ここにあなたの「Firebase設定」を貼り付けてね ★★★
    // Firebaseコンソールの「SDKの設定と構成」から丸ごとコピペしてOK
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      // storageBucket は今回は未使用
      // messagingSenderId も未使用
      appId: "YOUR_APP_ID"
    };

    // ---- ここから下はそのままでOK ----
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import {
      getFirestore, collection, addDoc, query, orderBy, limit, getDocs, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // ① まずは匿名ログイン（ボタン押す前にやっとく）
    signInAnonymously(auth).catch(console.error);
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // ログインできたらランキングを1回読み込む
        loadTop5();
      }
    });

    // DOM取得
    const nameInput = document.getElementById("playerName");
    const startBtn  = document.getElementById("startBtn");
    const quizArea  = document.getElementById("quizArea");
    const finishBtn = document.getElementById("finishBtn");
    const resultEl  = document.getElementById("result");
    const submitBtn = document.getElementById("submitBtn");
    const leaderboard = document.getElementById("leaderboard");
    const hello = document.getElementById("hello");
    const reloadBtn = document.getElementById("reloadBtn");

    // 名前 → スタート
    startBtn.addEventListener("click", () => {
      const name = (nameInput.value || "").trim();
      if (!name) { alert("名前を入れてな"); return; }
      hello.textContent = `がんばってな、${name}さん！`;
      quizArea.style.display = "block";
    });

    // サンプル：終了ボタンで点数を作る（0〜30点）
    let currentScore = null;
    finishBtn.addEventListener("click", () => {
      // 本番はあなたの採点結果をここに入れる
      currentScore = Math.floor(Math.random() * 31); // 満点30の例
      resultEl.textContent = `あなたのスコア：${currentScore}点`;
      submitBtn.disabled = false;
    });

    // スコア送信
    submitBtn.addEventListener("click", async () => {
      const name = (nameInput.value || "").trim() || "名無し";
      if (currentScore == null) { alert("先にクイズを終わらせてな"); return; }
      // Firestoreへ追加
      await addDoc(collection(db, "scores"), {
        name,
        score: currentScore,
        createdAt: serverTimestamp()
      });
      submitBtn.disabled = true;
      await loadTop5();
      alert("送信できたで！ランキングに反映されたか見てみてな");
    });

    // 上位5を読み込んで表示
    async function loadTop5() {
      const ref = collection(db, "scores");
      // 点数が同じなら早い者勝ち（createdAtの早い順）
      const q = query(ref, orderBy("score", "desc"), orderBy("createdAt", "asc"), limit(5));
      const snap = await getDocs(q);
      const rows = snap.docs.map((d, i) => {
        const r = d.data();
        return `<li>${i+1}. ${escapeHtml(r.name)} — ${r.score}点</li>`;
      });
      leaderboard.innerHTML = rows.length ? rows.join("") : "<li>まだ誰もいません</li>";
    }

    reloadBtn.addEventListener("click", loadTop5);

    // かんたんエスケープ（XSS対策の最低限）
    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
  </script>
</body>
</html>
